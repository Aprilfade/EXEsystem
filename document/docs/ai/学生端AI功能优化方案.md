# å­¦ç”Ÿç«¯AIåŠŸèƒ½ä¼˜åŒ–æ–¹æ¡ˆ

> ç‰ˆæœ¬ï¼šv3.03
> æ—¥æœŸï¼š2026-01-10
> ç›®æ ‡ï¼šå…¨é¢å‡çº§AIæ™ºèƒ½åŠŸèƒ½ï¼Œæ‰“é€ æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹

---

## ğŸ“‹ ç›®å½•

1. [ç°çŠ¶åˆ†æ](#ç°çŠ¶åˆ†æ)
2. [ä¼˜åŒ–ç›®æ ‡](#ä¼˜åŒ–ç›®æ ‡)
3. [æ™ºèƒ½æ¨èç³»ç»Ÿ](#æ™ºèƒ½æ¨èç³»ç»Ÿ)
4. [è‡ªç„¶è¯­è¨€æœç´¢](#è‡ªç„¶è¯­è¨€æœç´¢)
5. [é”™å› æ·±åº¦åˆ†æ](#é”™å› æ·±åº¦åˆ†æ)
6. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
7. [å®æ–½æ–¹æ¡ˆ](#å®æ–½æ–¹æ¡ˆ)
8. [é¢„æœŸæ”¶ç›Š](#é¢„æœŸæ”¶ç›Š)

---

## ğŸ“Š ç°çŠ¶åˆ†æ

### å½“å‰AIåŠŸèƒ½

#### 1. å·²å®ç°åŠŸèƒ½ âœ…

| åŠŸèƒ½ | å®ç°æ–¹å¼ | ä½¿ç”¨ç‡ | é—®é¢˜ |
|------|---------|--------|------|
| é”™é¢˜åˆ†æ | GPT APIè°ƒç”¨ | 20% | åˆ†æè¾ƒæµ…ï¼Œç¼ºå°‘ä¸ªæ€§åŒ– |
| æµå¼å“åº” | SSE | 15% | ä½“éªŒå¥½ä½†ä½¿ç”¨ç‡ä½ |
| ç¼“å­˜æœºåˆ¶ | Redis | - | å‘½ä¸­ç‡çº¦40% |
| é™çº§æ–¹æ¡ˆ | BasicAnalyzer | - | å‡†ç¡®åº¦ä¸€èˆ¬ |

#### 2. æŠ€æœ¯ç‰¹æ€§ âœ…

- âœ… å¤šAIæä¾›å•†æ”¯æŒï¼ˆDeepSeekã€OpenAIç­‰ï¼‰
- âœ… é™æµæœºåˆ¶ï¼ˆæ¯ç”¨æˆ·10æ¬¡/åˆ†é’Ÿï¼‰
- âœ… æ–­è·¯å™¨æ¨¡å¼ï¼ˆå¤±è´¥ç‡>50%è§¦å‘ï¼‰
- âœ… è°ƒç”¨æ—¥å¿—è®°å½•
- âœ… é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰

#### 3. ç¼ºå¤±åŠŸèƒ½ âŒ

- âŒ **æ™ºèƒ½æ¨èç³»ç»Ÿ** - æ— æ³•æ ¹æ®å­¦ä¹ è¡Œä¸ºæ¨èé¢˜ç›®/è¯¾ç¨‹
- âŒ **è‡ªç„¶è¯­è¨€æœç´¢** - åªèƒ½é€šè¿‡å…³é”®è¯æœç´¢ï¼Œæ— æ³•ç†è§£è¯­ä¹‰
- âŒ **æ·±åº¦é”™å› åˆ†æ** - åˆ†æä¸å¤Ÿä¸ªæ€§åŒ–ï¼Œç¼ºå°‘çŸ¥è¯†å›¾è°±
- âŒ **å­¦ä¹ è·¯å¾„è§„åˆ’** - æ— æ³•ç”Ÿæˆå®šåˆ¶åŒ–å­¦ä¹ è®¡åˆ’
- âŒ **æ™ºèƒ½å¯¹è¯** - ç¼ºå°‘AIå­¦ä¹ åŠ©æ‰‹å¯¹è¯åŠŸèƒ½

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡

1. **æå‡AIä½¿ç”¨ç‡**: ä»20% â†’ 50%
2. **å¢å¼ºä¸ªæ€§åŒ–**: åŸºäºç”¨æˆ·ç”»åƒçš„ç²¾å‡†æ¨è
3. **æ”¹å–„ç”¨æˆ·ä½“éªŒ**: è‡ªç„¶äº¤äº’ï¼Œå®æ—¶åé¦ˆ
4. **é™ä½æˆæœ¬**: æ™ºèƒ½ç¼“å­˜ï¼Œé™çº§æ–¹æ¡ˆä¼˜åŒ–

### ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½

```
AIåŠŸèƒ½ä¼˜åŒ–
â”œâ”€â”€ 1. æ™ºèƒ½æ¨èç³»ç»Ÿ (ååŒè¿‡æ»¤ç®—æ³•)
â”‚   â”œâ”€â”€ é¢˜ç›®æ¨è
â”‚   â”œâ”€â”€ è¯¾ç¨‹æ¨è
â”‚   â”œâ”€â”€ å­¦ä¹ è·¯å¾„æ¨è
â”‚   â””â”€â”€ é”™é¢˜æ¨è
â”‚
â”œâ”€â”€ 2. è‡ªç„¶è¯­è¨€æœç´¢ (AIæ„å›¾è¯†åˆ«)
â”‚   â”œâ”€â”€ è¯­ä¹‰ç†è§£
â”‚   â”œâ”€â”€ æ„å›¾åˆ†ç±»
â”‚   â”œâ”€â”€ å®ä½“æŠ½å–
â”‚   â””â”€â”€ æ™ºèƒ½é—®ç­”
â”‚
â””â”€â”€ 3. é”™å› æ·±åº¦åˆ†æ (GPTæ·±åº¦åˆ†æ)
    â”œâ”€â”€ å¤šç»´åº¦åˆ†æ
    â”œâ”€â”€ çŸ¥è¯†å›¾è°±æº¯æº
    â”œâ”€â”€ ä¸ªæ€§åŒ–å»ºè®®
    â””â”€â”€ å­¦ä¹ è·¯å¾„ç”Ÿæˆ
```

---

## ğŸ§  æ™ºèƒ½æ¨èç³»ç»Ÿ

### 1.1 ååŒè¿‡æ»¤ç®—æ³•

#### ç®—æ³•åŸç†

```
åŸºäºç”¨æˆ·-ç‰©å“ååŒè¿‡æ»¤ï¼ˆUser-Item Collaborative Filteringï¼‰

1. è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦
   - ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æˆ–çš®å°”é€Šç›¸å…³ç³»æ•°
   - è€ƒè™‘ç­”é¢˜æ­£ç¡®ç‡ã€ç­”é¢˜æ—¶é—´ã€ç­”é¢˜æ•°é‡ç­‰å¤šç»´ç‰¹å¾

2. æ‰¾åˆ°Kä¸ªæœ€ç›¸ä¼¼ç”¨æˆ·
   - Ké€šå¸¸å–10-20

3. æ¨èç›¸ä¼¼ç”¨æˆ·åšè¿‡çš„é¢˜ç›®
   - è¿‡æ»¤æ‰å½“å‰ç”¨æˆ·å·²åšé¢˜ç›®
   - æŒ‰é¢„æµ‹è¯„åˆ†æ’åº
```

#### åç«¯å®ç°

**æ­¥éª¤1: åˆ›å»ºæ¨èæœåŠ¡**

```java
// RecommendationService.java
package com.ice.exebackend.service;

import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.ice.exebackend.entity.*;
import com.ice.exebackend.mapper.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cache.annotation.Cacheable;
import org.springframework.stereotype.Service;

import java.util.*;
import java.util.stream.Collectors;

/**
 * AIæ™ºèƒ½æ¨èæœåŠ¡
 */
@Service
public class RecommendationService {

    @Autowired
    private BizExamResultMapper examResultMapper;

    @Autowired
    private BizQuestionMapper questionMapper;

    @Autowired
    private StudentCourseProgressMapper courseProgressMapper;

    /**
     * ç”¨æˆ·è¡Œä¸ºæ•°æ®
     */
    static class UserBehavior {
        Long userId;
        Long questionId;
        boolean correct;
        int timeSpent; // ç§’
        double difficulty; // é¢˜ç›®éš¾åº¦1-5

        public UserBehavior(Long userId, Long questionId, boolean correct, int timeSpent, double difficulty) {
            this.userId = userId;
            this.questionId = questionId;
            this.correct = correct;
            this.timeSpent = timeSpent;
            this.difficulty = difficulty;
        }
    }

    /**
     * ç”¨æˆ·ç›¸ä¼¼åº¦
     */
    static class UserSimilarity implements Comparable<UserSimilarity> {
        Long userId;
        double similarity;

        public UserSimilarity(Long userId, double similarity) {
            this.userId = userId;
            this.similarity = similarity;
        }

        @Override
        public int compareTo(UserSimilarity o) {
            return Double.compare(o.similarity, this.similarity); // é™åº
        }
    }

    /**
     * é¢˜ç›®æ¨èç»“æœ
     */
    public static class QuestionRecommendation {
        private Long questionId;
        private String content;
        private double score; // æ¨èåˆ†æ•°
        private String reason; // æ¨èç†ç”±

        // Getters and Setters
        public Long getQuestionId() { return questionId; }
        public void setQuestionId(Long questionId) { this.questionId = questionId; }
        public String getContent() { return content; }
        public void setContent(String content) { this.content = content; }
        public double getScore() { return score; }
        public void setScore(double score) { this.score = score; }
        public String getReason() { return reason; }
        public void setReason(String reason) { this.reason = reason; }
    }

    /**
     * æ¨èé¢˜ç›®ï¼ˆååŒè¿‡æ»¤ï¼‰
     * @param userId å½“å‰ç”¨æˆ·ID
     * @param subjectId ç§‘ç›®IDï¼ˆå¯é€‰ï¼‰
     * @param limit æ¨èæ•°é‡
     * @return æ¨èé¢˜ç›®åˆ—è¡¨
     */
    @Cacheable(value = "questionRecommendations", key = "#userId + '_' + #subjectId + '_' + #limit")
    public List<QuestionRecommendation> recommendQuestions(Long userId, Long subjectId, int limit) {
        // 1. è·å–æ‰€æœ‰ç”¨æˆ·çš„ç­”é¢˜è¡Œä¸º
        List<UserBehavior> allBehaviors = fetchAllUserBehaviors(subjectId);

        // 2. è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦
        List<UserSimilarity> similarUsers = calculateSimilarUsers(userId, allBehaviors, 20);

        if (similarUsers.isEmpty()) {
            // æ²¡æœ‰ç›¸ä¼¼ç”¨æˆ·ï¼Œè¿”å›çƒ­é—¨é¢˜ç›®
            return getPopularQuestions(subjectId, limit);
        }

        // 3. è·å–å½“å‰ç”¨æˆ·å·²åšé¢˜ç›®
        Set<Long> doneQuestions = getDoneQuestionIds(userId);

        // 4. æ¨èç›¸ä¼¼ç”¨æˆ·åšè¿‡ä½†å½“å‰ç”¨æˆ·æœªåšçš„é¢˜ç›®
        Map<Long, Double> questionScores = new HashMap<>();
        Map<Long, String> questionReasons = new HashMap<>();

        for (UserSimilarity similarUser : similarUsers) {
            List<UserBehavior> userBehaviors = allBehaviors.stream()
                    .filter(b -> b.userId.equals(similarUser.userId))
                    .collect(Collectors.toList());

            for (UserBehavior behavior : userBehaviors) {
                if (!doneQuestions.contains(behavior.questionId)) {
                    // è®¡ç®—æ¨èåˆ†æ•°
                    double score = calculateRecommendScore(behavior, similarUser.similarity);
                    questionScores.put(behavior.questionId,
                            questionScores.getOrDefault(behavior.questionId, 0.0) + score);

                    // ç”Ÿæˆæ¨èç†ç”±
                    if (!questionReasons.containsKey(behavior.questionId)) {
                        questionReasons.put(behavior.questionId,
                                generateRecommendReason(behavior, similarUser.similarity));
                    }
                }
            }
        }

        // 5. æŒ‰åˆ†æ•°æ’åºå¹¶è¿”å›Top N
        return questionScores.entrySet().stream()
                .sorted((e1, e2) -> Double.compare(e2.getValue(), e1.getValue()))
                .limit(limit)
                .map(entry -> {
                    QuestionRecommendation rec = new QuestionRecommendation();
                    rec.setQuestionId(entry.getKey());
                    rec.setScore(entry.getValue());
                    rec.setReason(questionReasons.get(entry.getKey()));

                    // æŸ¥è¯¢é¢˜ç›®å†…å®¹
                    BizQuestion question = questionMapper.selectById(entry.getKey());
                    if (question != null) {
                        rec.setContent(question.getContent());
                    }

                    return rec;
                })
                .collect(Collectors.toList());
    }

    /**
     * è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
     */
    private List<UserSimilarity> calculateSimilarUsers(Long targetUserId, List<UserBehavior> allBehaviors, int k) {
        // è·å–ç›®æ ‡ç”¨æˆ·çš„è¡Œä¸ºå‘é‡
        Map<Long, UserBehavior> targetVector = allBehaviors.stream()
                .filter(b -> b.userId.equals(targetUserId))
                .collect(Collectors.toMap(b -> b.questionId, b -> b));

        if (targetVector.isEmpty()) {
            return Collections.emptyList();
        }

        // è®¡ç®—ä¸å…¶ä»–ç”¨æˆ·çš„ç›¸ä¼¼åº¦
        Map<Long, List<UserBehavior>> userBehaviors = allBehaviors.stream()
                .filter(b -> !b.userId.equals(targetUserId))
                .collect(Collectors.groupingBy(b -> b.userId));

        List<UserSimilarity> similarities = new ArrayList<>();

        for (Map.Entry<Long, List<UserBehavior>> entry : userBehaviors.entrySet()) {
            Long otherUserId = entry.getKey();
            Map<Long, UserBehavior> otherVector = entry.getValue().stream()
                    .collect(Collectors.toMap(b -> b.questionId, b -> b));

            double similarity = cosineSimilarity(targetVector, otherVector);
            if (similarity > 0.1) { // ç›¸ä¼¼åº¦é˜ˆå€¼
                similarities.add(new UserSimilarity(otherUserId, similarity));
            }
        }

        // æ’åºå¹¶è¿”å›Top K
        Collections.sort(similarities);
        return similarities.stream().limit(k).collect(Collectors.toList());
    }

    /**
     * ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—
     */
    private double cosineSimilarity(Map<Long, UserBehavior> vec1, Map<Long, UserBehavior> vec2) {
        Set<Long> commonQuestions = new HashSet<>(vec1.keySet());
        commonQuestions.retainAll(vec2.keySet());

        if (commonQuestions.isEmpty()) {
            return 0.0;
        }

        double dotProduct = 0.0;
        double norm1 = 0.0;
        double norm2 = 0.0;

        for (Long questionId : commonQuestions) {
            UserBehavior b1 = vec1.get(questionId);
            UserBehavior b2 = vec2.get(questionId);

            // ç‰¹å¾å‘é‡ï¼š[æ­£ç¡®æ€§(0/1), å½’ä¸€åŒ–æ—¶é—´(0-1), éš¾åº¦(1-5)]
            double[] f1 = buildFeatureVector(b1);
            double[] f2 = buildFeatureVector(b2);

            for (int i = 0; i < f1.length; i++) {
                dotProduct += f1[i] * f2[i];
                norm1 += f1[i] * f1[i];
                norm2 += f2[i] * f2[i];
            }
        }

        if (norm1 == 0 || norm2 == 0) {
            return 0.0;
        }

        return dotProduct / (Math.sqrt(norm1) * Math.sqrt(norm2));
    }

    /**
     * æ„å»ºç‰¹å¾å‘é‡
     */
    private double[] buildFeatureVector(UserBehavior behavior) {
        return new double[]{
                behavior.correct ? 1.0 : 0.0,
                Math.min(behavior.timeSpent / 300.0, 1.0), // å½’ä¸€åŒ–åˆ°0-1
                behavior.difficulty / 5.0
        };
    }

    /**
     * è®¡ç®—æ¨èåˆ†æ•°
     */
    private double calculateRecommendScore(UserBehavior behavior, double userSimilarity) {
        // ç»¼åˆè€ƒè™‘ç”¨æˆ·ç›¸ä¼¼åº¦ã€é¢˜ç›®éš¾åº¦ã€ç­”é¢˜æ­£ç¡®æ€§
        double baseScore = userSimilarity * 10;

        // å¦‚æœç›¸ä¼¼ç”¨æˆ·ç­”å¯¹äº†ï¼Œå¢åŠ æƒé‡
        if (behavior.correct) {
            baseScore *= 1.5;
        }

        // éš¾åº¦é€‚ä¸­çš„é¢˜ç›®ä¼˜å…ˆæ¨è
        double difficultyFactor = 1.0 - Math.abs(behavior.difficulty - 3.0) / 5.0;
        baseScore *= (0.5 + difficultyFactor);

        return baseScore;
    }

    /**
     * ç”Ÿæˆæ¨èç†ç”±
     */
    private String generateRecommendReason(UserBehavior behavior, double similarity) {
        if (similarity > 0.7) {
            return "ä¸ä½ å­¦ä¹ ä¹ æƒ¯ç›¸ä¼¼çš„åŒå­¦éƒ½åœ¨ç»ƒä¹ è¿™é“é¢˜";
        } else if (behavior.correct) {
            return "è¿™é“é¢˜éš¾åº¦é€‚ä¸­ï¼Œå»ºè®®å·©å›ºç»ƒä¹ ";
        } else {
            return "è¿™é“é¢˜æ˜¯æ˜“é”™ç‚¹ï¼Œå€¼å¾—æŒ‘æˆ˜";
        }
    }

    /**
     * è·å–æ‰€æœ‰ç”¨æˆ·ç­”é¢˜è¡Œä¸ºï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…åº”ä»æ•°æ®åº“æŸ¥è¯¢ï¼‰
     */
    private List<UserBehavior> fetchAllUserBehaviors(Long subjectId) {
        // TODO: ä»æ•°æ®åº“æŸ¥è¯¢çœŸå®æ•°æ®
        // è¿™é‡Œéœ€è¦è”è¡¨æŸ¥è¯¢ exam_result + question + student_answer
        // SELECT student_id, question_id, is_correct, time_spent, difficulty
        // FROM student_answer sa
        // JOIN biz_question q ON sa.question_id = q.id
        // WHERE q.subject_id = ? (if subjectId != null)

        return new ArrayList<>(); // å ä½ï¼Œå®é™…éœ€å®ç°
    }

    /**
     * è·å–ç”¨æˆ·å·²åšé¢˜ç›®ID
     */
    private Set<Long> getDoneQuestionIds(Long userId) {
        // TODO: æŸ¥è¯¢ç”¨æˆ·ç­”é¢˜è®°å½•
        return new HashSet<>();
    }

    /**
     * è·å–çƒ­é—¨é¢˜ç›®ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
     */
    private List<QuestionRecommendation> getPopularQuestions(Long subjectId, int limit) {
        LambdaQueryWrapper<BizQuestion> wrapper = new LambdaQueryWrapper<>();
        if (subjectId != null) {
            wrapper.eq(BizQuestion::getSubjectId, subjectId);
        }
        wrapper.orderByDesc(BizQuestion::getId).last("LIMIT " + limit);

        List<BizQuestion> questions = questionMapper.selectList(wrapper);
        return questions.stream()
                .map(q -> {
                    QuestionRecommendation rec = new QuestionRecommendation();
                    rec.setQuestionId(q.getId());
                    rec.setContent(q.getContent());
                    rec.setScore(5.0);
                    rec.setReason("çƒ­é—¨é¢˜ç›®æ¨è");
                    return rec;
                })
                .collect(Collectors.toList());
    }

    /**
     * æ¨èè¯¾ç¨‹ï¼ˆåŸºäºå†…å®¹çš„æ¨èï¼‰
     */
    public List<CourseRecommendation> recommendCourses(Long userId, int limit) {
        // 1. åˆ†æç”¨æˆ·è–„å¼±ç§‘ç›®
        Map<Long, Double> subjectWeakness = analyzeWeakSubjects(userId);

        // 2. æ¨èå¯¹åº”ç§‘ç›®çš„è¯¾ç¨‹
        List<CourseRecommendation> recommendations = new ArrayList<>();

        for (Map.Entry<Long, Double> entry : subjectWeakness.entrySet()) {
            // TODO: æŸ¥è¯¢è¯¾ç¨‹å¹¶ç”Ÿæˆæ¨è
        }

        return recommendations;
    }

    /**
     * åˆ†æç”¨æˆ·è–„å¼±ç§‘ç›®
     */
    private Map<Long, Double> analyzeWeakSubjects(Long userId) {
        // TODO: ç»Ÿè®¡å„ç§‘ç›®æ­£ç¡®ç‡ï¼Œè¿”å›ä½äºå¹³å‡æ°´å¹³çš„ç§‘ç›®
        return new HashMap<>();
    }

    /**
     * è¯¾ç¨‹æ¨èç»“æœ
     */
    public static class CourseRecommendation {
        private Long courseId;
        private String name;
        private double score;
        private String reason;

        // Getters and Setters
    }
}
```

**æ­¥éª¤2: åˆ›å»ºController**

```java
// RecommendationController.java
package com.ice.exebackend.controller;

import com.ice.exebackend.common.Result;
import com.ice.exebackend.service.RecommendationService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/v1/student/recommendation")
@PreAuthorize("hasAuthority('ROLE_STUDENT')")
public class RecommendationController {

    @Autowired
    private RecommendationService recommendationService;

    /**
     * è·å–é¢˜ç›®æ¨è
     */
    @GetMapping("/questions")
    public Result getQuestionRecommendations(
            @RequestParam Long userId,
            @RequestParam(required = false) Long subjectId,
            @RequestParam(defaultValue = "10") int limit
    ) {
        List<RecommendationService.QuestionRecommendation> recommendations =
                recommendationService.recommendQuestions(userId, subjectId, limit);

        return Result.suc(recommendations);
    }

    /**
     * è·å–è¯¾ç¨‹æ¨è
     */
    @GetMapping("/courses")
    public Result getCourseRecommendations(
            @RequestParam Long userId,
            @RequestParam(defaultValue = "5") int limit
    ) {
        List<RecommendationService.CourseRecommendation> recommendations =
                recommendationService.recommendCourses(userId, limit);

        return Result.suc(recommendations);
    }
}
```

#### å‰ç«¯å®ç°

```vue
<!-- RecommendationPanel.vue -->
<template>
  <el-card class="recommendation-panel">
    <template #header>
      <div class="header-flex">
        <span>ğŸ¯ AIæ™ºèƒ½æ¨è</span>
        <el-button text @click="refreshRecommendations">
          <el-icon><Refresh /></el-icon>
          æ¢ä¸€æ‰¹
        </el-button>
      </div>
    </template>

    <el-tabs v-model="activeTab">
      <!-- é¢˜ç›®æ¨è -->
      <el-tab-pane label="é¢˜ç›®æ¨è" name="questions">
        <div v-loading="loading">
          <div
            v-for="(rec, index) in questionRecommendations"
            :key="rec.questionId"
            class="recommendation-item"
          >
            <div class="item-header">
              <el-tag type="info" size="small">æ¨è #{{ index + 1 }}</el-tag>
              <el-tag type="success" size="small">
                åŒ¹é…åº¦: {{ (rec.score * 10).toFixed(0) }}%
              </el-tag>
            </div>

            <div class="item-content">
              <p class="question-text">{{ rec.content }}</p>
              <p class="reason">
                <el-icon><InfoFilled /></el-icon>
                {{ rec.reason }}
              </p>
            </div>

            <div class="item-actions">
              <el-button type="primary" size="small" @click="startPractice(rec.questionId)">
                ç«‹å³ç»ƒä¹ 
              </el-button>
              <el-button size="small" @click="viewDetail(rec.questionId)">
                æŸ¥çœ‹è¯¦æƒ…
              </el-button>
            </div>
          </div>

          <el-empty
            v-if="questionRecommendations.length === 0 && !loading"
            description="æš‚æ— æ¨èé¢˜ç›®"
          />
        </div>
      </el-tab-pane>

      <!-- è¯¾ç¨‹æ¨è -->
      <el-tab-pane label="è¯¾ç¨‹æ¨è" name="courses">
        <div v-loading="loading">
          <div
            v-for="rec in courseRecommendations"
            :key="rec.courseId"
            class="course-card"
          >
            <div class="course-info">
              <h4>{{ rec.name }}</h4>
              <p class="course-reason">{{ rec.reason }}</p>
            </div>
            <el-button type="primary" @click="goToCourse(rec.courseId)">
              å¼€å§‹å­¦ä¹ 
            </el-button>
          </div>
        </div>
      </el-tab-pane>
    </el-tabs>
  </el-card>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useStudentAuthStore } from '@/stores/studentAuth';
import { Refresh, InfoFilled } from '@element-plus/icons-vue';
import request from '@/utils/request';

const studentStore = useStudentAuthStore();

const activeTab = ref('questions');
const loading = ref(false);
const questionRecommendations = ref<any[]>([]);
const courseRecommendations = ref<any[]>([]);

const fetchQuestionRecommendations = async () => {
  loading.value = true;
  try {
    const res = await request({
      url: '/api/v1/student/recommendation/questions',
      method: 'get',
      params: {
        userId: studentStore.userId,
        limit: 10
      }
    });

    if (res.code === 200) {
      questionRecommendations.value = res.data;
    }
  } catch (error) {
    console.error('è·å–æ¨èå¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
};

const fetchCourseRecommendations = async () => {
  loading.value = true;
  try {
    const res = await request({
      url: '/api/v1/student/recommendation/courses',
      method: 'get',
      params: {
        userId: studentStore.userId,
        limit: 5
      }
    });

    if (res.code === 200) {
      courseRecommendations.value = res.data;
    }
  } catch (error) {
    console.error('è·å–è¯¾ç¨‹æ¨èå¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
};

const refreshRecommendations = () => {
  if (activeTab.value === 'questions') {
    fetchQuestionRecommendations();
  } else {
    fetchCourseRecommendations();
  }
};

onMounted(() => {
  fetchQuestionRecommendations();
});
</script>

<style scoped>
.recommendation-panel {
  margin-bottom: 20px;
}

.header-flex {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.recommendation-item {
  background: #f5f7fa;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 15px;
  transition: all 0.3s;
}

.recommendation-item:hover {
  background: #e6f0ff;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(64, 158, 255, 0.2);
}

.item-header {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.item-content {
  margin-bottom: 15px;
}

.question-text {
  font-size: 14px;
  color: #303133;
  margin-bottom: 8px;
}

.reason {
  font-size: 12px;
  color: #909399;
  display: flex;
  align-items: center;
  gap: 5px;
}

.item-actions {
  display: flex;
  gap: 10px;
}

.course-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #f5f7fa;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 15px;
}

.course-info h4 {
  margin: 0 0 8px 0;
  color: #303133;
}

.course-reason {
  font-size: 12px;
  color: #909399;
  margin: 0;
}
</style>
```

---

## ğŸ” è‡ªç„¶è¯­è¨€æœç´¢

### 2.1 AIæ„å›¾è¯†åˆ«

#### æ„å›¾åˆ†ç±»

```
ç”¨æˆ·è¾“å…¥ â†’ AIæ„å›¾è¯†åˆ« â†’ æ‰§è¡Œå¯¹åº”æ“ä½œ

æ„å›¾ç±»å‹:
1. FIND_QUESTION - æœç´¢é¢˜ç›®
2. LEARN_CONCEPT - å­¦ä¹ çŸ¥è¯†ç‚¹
3. ASK_QUESTION - æé—®
4. FIND_COURSE - æŸ¥æ‰¾è¯¾ç¨‹
5. CHECK_PROGRESS - æŸ¥çœ‹è¿›åº¦
```

#### åç«¯å®ç°

```java
// NaturalLanguageSearchService.java
package com.ice.exebackend.service;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.ice.exebackend.utils.AiHttpClient;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.*;

/**
 * è‡ªç„¶è¯­è¨€æœç´¢æœåŠ¡
 */
@Service
public class NaturalLanguageSearchService {

    @Autowired
    private AiHttpClient aiHttpClient;

    @Autowired
    private ObjectMapper objectMapper;

    @Autowired
    private BizQuestionMapper questionMapper;

    @Autowired
    private CourseMapper courseMapper;

    /**
     * ç”¨æˆ·æ„å›¾
     */
    public enum Intent {
        FIND_QUESTION("æœç´¢é¢˜ç›®"),
        LEARN_CONCEPT("å­¦ä¹ çŸ¥è¯†ç‚¹"),
        ASK_QUESTION("æé—®"),
        FIND_COURSE("æŸ¥æ‰¾è¯¾ç¨‹"),
        CHECK_PROGRESS("æŸ¥çœ‹è¿›åº¦"),
        UNKNOWN("æœªçŸ¥");

        private final String description;

        Intent(String description) {
            this.description = description;
        }
    }

    /**
     * æ„å›¾è¯†åˆ«ç»“æœ
     */
    public static class IntentAnalysis {
        private Intent intent;
        private List<String> keywords;
        private String concept;
        private Map<String, Object> entities;

        public IntentAnalysis() {
            this.entities = new HashMap<>();
        }

        // Getters and Setters
        public Intent getIntent() { return intent; }
        public void setIntent(Intent intent) { this.intent = intent; }
        public List<String> getKeywords() { return keywords; }
        public void setKeywords(List<String> keywords) { this.keywords = keywords; }
        public String getConcept() { return concept; }
        public void setConcept(String concept) { this.concept = concept; }
        public Map<String, Object> getEntities() { return entities; }
        public void setEntities(Map<String, Object> entities) { this.entities = entities; }
    }

    /**
     * æœç´¢ç»“æœ
     */
    public static class SearchResult {
        private Intent intent;
        private List<QuestionResult> questions;
        private List<CourseResult> courses;
        private String answer; // AIç›´æ¥å›ç­”

        // Getters and Setters
        public Intent getIntent() { return intent; }
        public void setIntent(Intent intent) { this.intent = intent; }
        public List<QuestionResult> getQuestions() { return questions; }
        public void setQuestions(List<QuestionResult> questions) { this.questions = questions; }
        public List<CourseResult> getCourses() { return courses; }
        public void setCourses(List<CourseResult> courses) { this.courses = courses; }
        public String getAnswer() { return answer; }
        public void setAnswer(String answer) { this.answer = answer; }
    }

    public static class QuestionResult {
        private Long id;
        private String content;
        private double relevance;

        // Getters and Setters
    }

    public static class CourseResult {
        private Long id;
        private String name;
        private double relevance;

        // Getters and Setters
    }

    /**
     * è‡ªç„¶è¯­è¨€æœç´¢
     */
    public SearchResult search(String apiKey, String provider, String query) throws Exception {
        // 1. æ„å›¾è¯†åˆ«
        IntentAnalysis analysis = analyzeIntent(apiKey, provider, query);

        // 2. æ ¹æ®æ„å›¾æ‰§è¡Œå¯¹åº”æ“ä½œ
        SearchResult result = new SearchResult();
        result.setIntent(analysis.getIntent());

        switch (analysis.getIntent()) {
            case FIND_QUESTION:
                result.setQuestions(searchQuestions(analysis.getKeywords()));
                break;

            case LEARN_CONCEPT:
                result.setCourses(searchCourses(analysis.getConcept()));
                break;

            case ASK_QUESTION:
                result.setAnswer(askAI(apiKey, provider, query));
                break;

            case FIND_COURSE:
                result.setCourses(searchCourses(analysis.getKeywords().get(0)));
                break;

            case CHECK_PROGRESS:
                // TODO: è¿”å›å­¦ä¹ è¿›åº¦ä¿¡æ¯
                break;

            default:
                result.setAnswer("æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£æ‚¨çš„é—®é¢˜ï¼Œè¯·æ¢ä¸€ç§æ–¹å¼è¡¨è¾¾ã€‚");
        }

        return result;
    }

    /**
     * AIæ„å›¾è¯†åˆ«
     */
    private IntentAnalysis analyzeIntent(String apiKey, String provider, String query) throws Exception {
        String prompt = String.format("""
                ä½ æ˜¯ä¸€ä¸ªæ•™è‚²å¹³å°çš„æ™ºèƒ½åŠ©æ‰‹ã€‚è¯·åˆ†æç”¨æˆ·çš„æœç´¢æ„å›¾å¹¶æå–å…³é”®ä¿¡æ¯ã€‚

                ç”¨æˆ·è¾“å…¥ï¼š%s

                è¯·ä»¥JSONæ ¼å¼è¿”å›ï¼š
                {
                  "intent": "FIND_QUESTION | LEARN_CONCEPT | ASK_QUESTION | FIND_COURSE | CHECK_PROGRESS",
                  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2"],
                  "concept": "æ ¸å¿ƒçŸ¥è¯†ç‚¹",
                  "entities": {
                    "subject": "ç§‘ç›®",
                    "grade": "å¹´çº§",
                    "difficulty": "éš¾åº¦"
                  }
                }

                æ„å›¾å®šä¹‰ï¼š
                - FIND_QUESTION: æœç´¢é¢˜ç›®ï¼ˆå¦‚"æ‰¾ä¸€äº›æ•°å­¦é¢˜"ã€"ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹çš„é¢˜"ï¼‰
                - LEARN_CONCEPT: å­¦ä¹ çŸ¥è¯†ç‚¹ï¼ˆå¦‚"å­¦ä¹ å‡½æ•°"ã€"ä»€ä¹ˆæ˜¯å¯¼æ•°"ï¼‰
                - ASK_QUESTION: æé—®æ±‚åŠ©ï¼ˆå¦‚"è¿™é“é¢˜æ€ä¹ˆåš"ã€"ä¸ºä»€ä¹ˆé€‰C"ï¼‰
                - FIND_COURSE: æŸ¥æ‰¾è¯¾ç¨‹ï¼ˆå¦‚"æœ‰ä»€ä¹ˆç‰©ç†è¯¾ç¨‹"ï¼‰
                - CHECK_PROGRESS: æŸ¥çœ‹è¿›åº¦ï¼ˆå¦‚"æˆ‘çš„å­¦ä¹ æƒ…å†µ"ã€"æ­£ç¡®ç‡"ï¼‰
                """, query);

        List<Map<String, String>> messages = new ArrayList<>();
        messages.add(Map.of("role", "user", "content", prompt));

        String response = aiHttpClient.call(apiKey, provider, messages, false);

        // è§£æJSONå“åº”
        IntentAnalysis analysis = new IntentAnalysis();

        try {
            JsonNode jsonNode = objectMapper.readTree(response);

            String intentStr = jsonNode.path("intent").asText();
            analysis.setIntent(Intent.valueOf(intentStr));

            List<String> keywords = new ArrayList<>();
            jsonNode.path("keywords").forEach(node -> keywords.add(node.asText()));
            analysis.setKeywords(keywords);

            analysis.setConcept(jsonNode.path("concept").asText());

            Map<String, Object> entities = new HashMap<>();
            jsonNode.path("entities").fields().forEachRemaining(entry -> {
                entities.put(entry.getKey(), entry.getValue().asText());
            });
            analysis.setEntities(entities);

        } catch (Exception e) {
            // JSONè§£æå¤±è´¥ï¼Œä½¿ç”¨è§„åˆ™å…œåº•
            analysis = ruleBasedIntentAnalysis(query);
        }

        return analysis;
    }

    /**
     * åŸºäºè§„åˆ™çš„æ„å›¾è¯†åˆ«ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
     */
    private IntentAnalysis ruleBasedIntentAnalysis(String query) {
        IntentAnalysis analysis = new IntentAnalysis();

        query = query.toLowerCase();

        if (query.contains("é¢˜") || query.contains("ç»ƒä¹ ")) {
            analysis.setIntent(Intent.FIND_QUESTION);
        } else if (query.contains("å­¦ä¹ ") || query.contains("ä»€ä¹ˆæ˜¯") || query.contains("å¦‚ä½•")) {
            analysis.setIntent(Intent.LEARN_CONCEPT);
        } else if (query.contains("è¯¾ç¨‹") || query.contains("è§†é¢‘")) {
            analysis.setIntent(Intent.FIND_COURSE);
        } else if (query.contains("è¿›åº¦") || query.contains("æ­£ç¡®ç‡") || query.contains("ç»Ÿè®¡")) {
            analysis.setIntent(Intent.CHECK_PROGRESS);
        } else {
            analysis.setIntent(Intent.ASK_QUESTION);
        }

        // ç®€å•å…³é”®è¯æå–ï¼ˆç©ºæ ¼åˆ†è¯ï¼‰
        analysis.setKeywords(Arrays.asList(query.split("\\s+")));

        return analysis;
    }

    /**
     * æœç´¢é¢˜ç›®
     */
    private List<QuestionResult> searchQuestions(List<String> keywords) {
        // TODO: ä½¿ç”¨Elasticsearchæˆ–æ•°æ®åº“å…¨æ–‡æœç´¢
        return new ArrayList<>();
    }

    /**
     * æœç´¢è¯¾ç¨‹
     */
    private List<CourseResult> searchCourses(String concept) {
        // TODO: è¯¾ç¨‹æœç´¢
        return new ArrayList<>();
    }

    /**
     * AIé—®ç­”
     */
    private String askAI(String apiKey, String provider, String question) throws Exception {
        List<Map<String, String>> messages = new ArrayList<>();
        messages.add(Map.of("role", "system", "content", "ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ä¸­å­¦æ•™å¸ˆï¼Œè¯·ç”¨ç®€æ´æ˜“æ‡‚çš„è¯­è¨€å›ç­”å­¦ç”Ÿçš„é—®é¢˜ã€‚"));
        messages.add(Map.of("role", "user", "content", question));

        return aiHttpClient.call(apiKey, provider, messages, false);
    }
}
```

**Controller**

```java
// NaturalLanguageSearchController.java
@RestController
@RequestMapping("/api/v1/student/nlp-search")
@PreAuthorize("hasAuthority('ROLE_STUDENT')")
public class NaturalLanguageSearchController {

    @Autowired
    private NaturalLanguageSearchService searchService;

    @PostMapping("/query")
    public Result search(@RequestBody Map<String, String> req, HttpServletRequest request) throws Exception {
        String query = req.get("query");
        String apiKey = request.getHeader("X-Ai-Api-Key");
        String provider = request.getHeader("X-Ai-Provider");

        NaturalLanguageSearchService.SearchResult result =
                searchService.search(apiKey, provider, query);

        return Result.suc(result);
    }
}
```

#### å‰ç«¯å®ç°

```vue
<!-- SmartSearchBar.vue -->
<template>
  <div class="smart-search-bar">
    <el-input
      v-model="searchQuery"
      placeholder="è¯•è¯•ç”¨è‡ªç„¶è¯­è¨€æœç´¢ï¼šæˆ‘æƒ³å­¦ä¹ å‡½æ•°ã€æ‰¾ä¸€äº›æ•°å­¦é¢˜..."
      clearable
      @keyup.enter="handleSearch"
    >
      <template #prefix>
        <el-icon class="search-icon"><MagicStick /></el-icon>
      </template>
      <template #append>
        <el-button @click="handleSearch" :loading="searching">
          æ™ºèƒ½æœç´¢
        </el-button>
      </template>
    </el-input>

    <!-- æœç´¢å»ºè®® -->
    <div v-if="showSuggestions" class="search-suggestions">
      <div class="suggestion-item" @click="quickSearch('æˆ‘æƒ³ç»ƒä¹ ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹')">
        ğŸ’¡ æˆ‘æƒ³ç»ƒä¹ ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹
      </div>
      <div class="suggestion-item" @click="quickSearch('ä»€ä¹ˆæ˜¯å¯¼æ•°')">
        ğŸ’¡ ä»€ä¹ˆæ˜¯å¯¼æ•°
      </div>
      <div class="suggestion-item" @click="quickSearch('æŸ¥çœ‹æˆ‘çš„å­¦ä¹ è¿›åº¦')">
        ğŸ’¡ æŸ¥çœ‹æˆ‘çš„å­¦ä¹ è¿›åº¦
      </div>
    </div>

    <!-- æœç´¢ç»“æœå¯¹è¯æ¡† -->
    <el-dialog
      v-model="showResults"
      :title="`æœç´¢ç»“æœ - ${intentName}`"
      width="800px"
    >
      <!-- AIç›´æ¥å›ç­” -->
      <div v-if="searchResult.answer" class="ai-answer">
        <h4>ğŸ¤– AIå›ç­”</h4>
        <div class="answer-content">{{ searchResult.answer }}</div>
      </div>

      <!-- é¢˜ç›®ç»“æœ -->
      <div v-if="searchResult.questions && searchResult.questions.length > 0">
        <h4>ğŸ“ ç›¸å…³é¢˜ç›®</h4>
        <div
          v-for="q in searchResult.questions"
          :key="q.id"
          class="result-item"
        >
          <p>{{ q.content }}</p>
          <el-tag size="small">ç›¸å…³åº¦: {{ (q.relevance * 100).toFixed(0) }}%</el-tag>
          <el-button type="primary" link @click="viewQuestion(q.id)">
            æŸ¥çœ‹è¯¦æƒ…
          </el-button>
        </div>
      </div>

      <!-- è¯¾ç¨‹ç»“æœ -->
      <div v-if="searchResult.courses && searchResult.courses.length > 0">
        <h4>ğŸ“š æ¨èè¯¾ç¨‹</h4>
        <div
          v-for="c in searchResult.courses"
          :key="c.id"
          class="result-item"
        >
          <p>{{ c.name }}</p>
          <el-button type="primary" @click="gotoCourse(c.id)">
            å¼€å§‹å­¦ä¹ 
          </el-button>
        </div>
      </div>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { MagicStick } from '@element-plus/icons-vue';
import request from '@/utils/request';
import { useStudentAuthStore } from '@/stores/studentAuth';

const studentStore = useStudentAuthStore();

const searchQuery = ref('');
const searching = ref(false);
const showSuggestions = ref(false);
const showResults = ref(false);
const searchResult = ref<any>({});

const intentNames: Record<string, string> = {
  FIND_QUESTION: 'é¢˜ç›®æœç´¢',
  LEARN_CONCEPT: 'çŸ¥è¯†å­¦ä¹ ',
  ASK_QUESTION: 'æ™ºèƒ½é—®ç­”',
  FIND_COURSE: 'è¯¾ç¨‹æŸ¥æ‰¾',
  CHECK_PROGRESS: 'å­¦ä¹ è¿›åº¦'
};

const intentName = computed(() => {
  return intentNames[searchResult.value.intent] || 'æœç´¢';
});

const handleSearch = async () => {
  if (!searchQuery.value.trim()) return;

  searching.value = true;
  showSuggestions.value = false;

  try {
    const res = await request({
      url: '/api/v1/student/nlp-search/query',
      method: 'post',
      data: { query: searchQuery.value },
      headers: {
        'X-Ai-Api-Key': studentStore.aiKey,
        'X-Ai-Provider': studentStore.aiProvider
      }
    });

    if (res.code === 200) {
      searchResult.value = res.data;
      showResults.value = true;
    }
  } catch (error) {
    console.error('æœç´¢å¤±è´¥:', error);
  } finally {
    searching.value = false;
  }
};

const quickSearch = (query: string) => {
  searchQuery.value = query;
  handleSearch();
};
</script>

<style scoped>
.smart-search-bar {
  margin-bottom: 20px;
}

.search-icon {
  color: #409eff;
}

.search-suggestions {
  background: white;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  margin-top: 8px;
  padding: 8px 0;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

.suggestion-item {
  padding: 10px 15px;
  cursor: pointer;
  transition: background 0.3s;
}

.suggestion-item:hover {
  background: #f5f7fa;
}

.ai-answer {
  background: #e6f7ff;
  border-left: 4px solid #409eff;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 4px;
}

.answer-content {
  margin-top: 10px;
  line-height: 1.8;
}

.result-item {
  background: #f5f7fa;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
```

---

## ğŸ“– é”™å› æ·±åº¦åˆ†æ

### 3.1 å¤šç»´åº¦åˆ†æ

#### åˆ†æç»´åº¦

```
é”™å› æ·±åº¦åˆ†ææ¡†æ¶ï¼š

1. çŸ¥è¯†ç‚¹ç»´åº¦
   â”œâ”€â”€ æ¦‚å¿µç†è§£é”™è¯¯
   â”œâ”€â”€ å…¬å¼è®°å¿†é”™è¯¯
   â””â”€â”€ çŸ¥è¯†è¿ç§»é”™è¯¯

2. æ€ç»´æ–¹å¼ç»´åº¦
   â”œâ”€â”€ é€»è¾‘æ¨ç†é”™è¯¯
   â”œâ”€â”€ è®¡ç®—å¤±è¯¯
   â””â”€â”€ å®¡é¢˜ä¸æ¸…

3. å­¦ä¹ ä¹ æƒ¯ç»´åº¦
   â”œâ”€â”€ ç²—å¿ƒå¤§æ„
   â”œâ”€â”€ æ—¶é—´ç®¡ç†
   â””â”€â”€ åº”è¯•æŠ€å·§

4. æƒ…æ„Ÿæ€åº¦ç»´åº¦
   â”œâ”€â”€ ç•éš¾æƒ…ç»ª
   â”œâ”€â”€ è‡ªä¿¡å¿ƒä¸è¶³
   â””â”€â”€ å­¦ä¹ åŠ¨æœº
```

#### åç«¯å¢å¼º

```java
// EnhancedWrongAnalysisService.java
@Service
public class EnhancedWrongAnalysisService {

    @Autowired
    private AiHttpClient aiHttpClient;

    @Autowired
    private KnowledgeGraphService knowledgeGraphService;

    @Autowired
    private StudentLearningProfileService profileService;

    /**
     * æ·±åº¦é”™å› åˆ†æ
     */
    public DeepAnalysisResult analyzeWrongQuestionDeep(
            String apiKey,
            String provider,
            Long userId,
            AiAnalysisReq req
    ) throws Exception {

        // 1. è·å–å­¦ç”Ÿå­¦ä¹ ç”»åƒ
        StudentLearningProfile profile = profileService.getProfile(userId);

        // 2. çŸ¥è¯†å›¾è°±æº¯æº
        List<KnowledgePoint> prerequisitePoints =
                knowledgeGraphService.tracePrerequisites(req.getQuestionKnowledgePointId());

        // 3. æ„å»ºä¸ªæ€§åŒ–æç¤ºè¯
        String enhancedPrompt = buildEnhancedPrompt(req, profile, prerequisitePoints);

        // 4. è°ƒç”¨AIåˆ†æ
        List<Map<String, String>> messages = new ArrayList<>();
        messages.add(Map.of("role", "system", "content", getSystemPrompt()));
        messages.add(Map.of("role", "user", "content", enhancedPrompt));

        String aiResponse = aiHttpClient.call(apiKey, provider, messages, false);

        // 5. è§£æåˆ†æç»“æœ
        DeepAnalysisResult result = parseAnalysisResult(aiResponse);

        // 6. é™„åŠ æ¨èå­¦ä¹ è·¯å¾„
        result.setLearningPath(generateLearningPath(userId, result));

        return result;
    }

    /**
     * æ„å»ºå¢å¼ºæç¤ºè¯
     */
    private String buildEnhancedPrompt(
            AiAnalysisReq req,
            StudentLearningProfile profile,
            List<KnowledgePoint> prerequisites
    ) {
        StringBuilder prompt = new StringBuilder();

        prompt.append("ã€å­¦ç”Ÿç”»åƒã€‘\n");
        prompt.append(String.format("- æ•´ä½“æ°´å¹³ï¼š%s\n", profile.getLevel()));
        prompt.append(String.format("- å­¦ä¹ é£æ ¼ï¼š%s\n", profile.getLearningStyle()));
        prompt.append(String.format("- è–„å¼±ç¯èŠ‚ï¼š%s\n", String.join("ã€", profile.getWeakPoints())));
        prompt.append("\n");

        prompt.append("ã€é¢˜ç›®ä¿¡æ¯ã€‘\n");
        prompt.append(String.format("é¢˜ç›®ï¼š%s\n", req.getQuestionContent()));
        prompt.append(String.format("æ­£ç¡®ç­”æ¡ˆï¼š%s\n", req.getCorrectAnswer()));
        prompt.append(String.format("å­¦ç”Ÿç­”æ¡ˆï¼š%s\n", req.getStudentAnswer()));
        prompt.append(String.format("åŸè§£æï¼š%s\n", req.getAnalysis()));
        prompt.append("\n");

        if (!prerequisites.isEmpty()) {
            prompt.append("ã€å‰ç½®çŸ¥è¯†ç‚¹ã€‘\n");
            for (KnowledgePoint kp : prerequisites) {
                prompt.append(String.format("- %sï¼ˆæŒæ¡åº¦ï¼š%.0f%%ï¼‰\n",
                        kp.getName(), kp.getMasteryLevel() * 100));
            }
            prompt.append("\n");
        }

        prompt.append("ã€åˆ†æè¦æ±‚ã€‘\n");
        prompt.append("è¯·ä»ä»¥ä¸‹å››ä¸ªç»´åº¦è¿›è¡Œæ·±åº¦åˆ†æï¼š\n");
        prompt.append("1. **çŸ¥è¯†ç‚¹è¯Šæ–­**ï¼šå®šä½çŸ¥è¯†æ¼æ´ï¼Œæ£€æŸ¥å‰ç½®çŸ¥è¯†æ˜¯å¦æŒæ¡\n");
        prompt.append("2. **æ€ç»´æ–¹å¼åˆ†æ**ï¼šåˆ†æè§£é¢˜æ€è·¯çš„åå·®\n");
        prompt.append("3. **å­¦ä¹ ä¹ æƒ¯è¯„ä¼°**ï¼šåˆ¤æ–­æ˜¯ç²—å¿ƒè¿˜æ˜¯çœŸä¸ä¼š\n");
        prompt.append("4. **ä¸ªæ€§åŒ–å»ºè®®**ï¼šç»“åˆå­¦ç”Ÿç”»åƒç»™å‡ºé’ˆå¯¹æ€§å»ºè®®\n");
        prompt.append("\n");
        prompt.append("è¯·ç”¨Markdownæ ¼å¼è¾“å‡ºï¼Œè¯­æ°”é¼“åŠ±å’Œè€å¿ƒã€‚");

        return prompt.toString();
    }

    /**
     * ç³»ç»Ÿæç¤ºè¯
     */
    private String getSystemPrompt() {
        return "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„æ•™è‚²ä¸“å®¶å’Œå¿ƒç†å’¨è¯¢å¸ˆï¼Œæ“…é•¿æ·±å…¥åˆ†æå­¦ç”Ÿçš„å­¦ä¹ é—®é¢˜ã€‚" +
                "ä½ çš„åˆ†æä¸ä»…å…³æ³¨çŸ¥è¯†å±‚é¢ï¼Œæ›´å…³æ³¨å­¦ç”Ÿçš„æ€ç»´æ–¹å¼ã€å­¦ä¹ ä¹ æƒ¯å’Œå¿ƒç†çŠ¶æ€ã€‚" +
                "ä½ çš„å»ºè®®æ€»æ˜¯å…·ä½“ã€å¯æ“ä½œï¼Œå¹¶ä¸”å……æ»¡é¼“åŠ±ã€‚";
    }

    /**
     * è§£æåˆ†æç»“æœ
     */
    private DeepAnalysisResult parseAnalysisResult(String aiResponse) {
        DeepAnalysisResult result = new DeepAnalysisResult();
        result.setFullAnalysis(aiResponse);

        // TODO: ä½¿ç”¨NLPæŠ€æœ¯æå–ç»“æ„åŒ–ä¿¡æ¯
        // - çŸ¥è¯†ç‚¹åˆ—è¡¨
        // - é”™è¯¯ç±»å‹
        // - å»ºè®®åˆ—è¡¨

        return result;
    }

    /**
     * ç”Ÿæˆå­¦ä¹ è·¯å¾„
     */
    private List<LearningPathStep> generateLearningPath(Long userId, DeepAnalysisResult analysis) {
        List<LearningPathStep> path = new ArrayList<>();

        // æ­¥éª¤1: å¤ä¹ å‰ç½®çŸ¥è¯†
        path.add(new LearningPathStep(
                "å¤ä¹ å‰ç½®çŸ¥è¯†",
                "å…ˆå·©å›ºåŸºç¡€çŸ¥è¯†ï¼Œç¡®ä¿ç†è§£æ ¸å¿ƒæ¦‚å¿µ",
                "REVIEW",
                null // æ¨èçš„è¯¾ç¨‹/é¢˜ç›®ID
        ));

        // æ­¥éª¤2: ä¸“é¡¹ç»ƒä¹ 
        path.add(new LearningPathStep(
                "ä¸“é¡¹ç»ƒä¹ ",
                "é’ˆå¯¹è–„å¼±ç¯èŠ‚è¿›è¡Œä¸“é¡¹è®­ç»ƒ",
                "PRACTICE",
                null
        ));

        // æ­¥éª¤3: ç»¼åˆæå‡
        path.add(new LearningPathStep(
                "ç»¼åˆæå‡",
                "é€šè¿‡ç»¼åˆé¢˜ç›®æå‡åº”ç”¨èƒ½åŠ›",
                "IMPROVE",
                null
        ));

        return path;
    }

    /**
     * æ·±åº¦åˆ†æç»“æœ
     */
    public static class DeepAnalysisResult {
        private String fullAnalysis; // å®Œæ•´çš„AIåˆ†ææ–‡æœ¬
        private List<String> knowledgePoints; // æ¶‰åŠçš„çŸ¥è¯†ç‚¹
        private String errorType; // é”™è¯¯ç±»å‹
        private List<String> suggestions; // å»ºè®®åˆ—è¡¨
        private List<LearningPathStep> learningPath; // å­¦ä¹ è·¯å¾„

        // Getters and Setters
    }

    /**
     * å­¦ä¹ è·¯å¾„æ­¥éª¤
     */
    public static class LearningPathStep {
        private String title;
        private String description;
        private String type; // REVIEW, PRACTICE, IMPROVE
        private Long resourceId;

        public LearningPathStep(String title, String description, String type, Long resourceId) {
            this.title = title;
            this.description = description;
            this.type = type;
            this.resourceId = resourceId;
        }

        // Getters and Setters
    }
}
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±‚ (Vue3)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RecommendationPanel â”‚ SmartSearchBar â”‚ AIAnalysisPanel â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                â”‚                 â”‚
             â–¼                â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API Gatewayå±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RecommendationController â”‚ SearchController â”‚ AIController
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                â”‚                 â”‚
             â–¼                â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡æœåŠ¡å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Recommendation  â”‚ NLPSearch â”‚ EnhancedAnalysis â”‚ AIServiceV3
â”‚ Service         â”‚ Service   â”‚ Service          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                â”‚                 â”‚
             â–¼                â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®&AIå±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MySQL â”‚ Redis â”‚ Elasticsearch â”‚ AI Provider (DeepSeek/GPT)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å®æ–½æ–¹æ¡ˆ

### Phase 1: æ™ºèƒ½æ¨èç³»ç»Ÿï¼ˆ2å‘¨ï¼‰

**Week 1**
- [ ] æ•°æ®é‡‡é›†ï¼šç”¨æˆ·ç­”é¢˜è¡Œä¸ºã€å­¦ä¹ è®°å½•
- [ ] ç®—æ³•å®ç°ï¼šååŒè¿‡æ»¤æ ¸å¿ƒä»£ç 
- [ ] æ•°æ®åº“è®¾è®¡ï¼šuser_behaviorè¡¨

**Week 2**
- [ ] APIå¼€å‘ï¼šæ¨èæ¥å£
- [ ] å‰ç«¯ç»„ä»¶ï¼šRecommendationPanel
- [ ] æµ‹è¯•ä¼˜åŒ–ï¼šæ¨èå‡†ç¡®åº¦æµ‹è¯•

### Phase 2: è‡ªç„¶è¯­è¨€æœç´¢ï¼ˆ1.5å‘¨ï¼‰

**Week 3-4**
- [ ] æ„å›¾è¯†åˆ«æ¨¡å‹è®­ç»ƒ
- [ ] NLP Serviceå®ç°
- [ ] æœç´¢ç»“æœèšåˆ
- [ ] å‰ç«¯æœç´¢ç»„ä»¶

### Phase 3: é”™å› æ·±åº¦åˆ†æï¼ˆ1.5å‘¨ï¼‰

**Week 5-6**
- [ ] å­¦ç”Ÿç”»åƒç³»ç»Ÿ
- [ ] çŸ¥è¯†å›¾è°±æº¯æº
- [ ] AIæç¤ºè¯ä¼˜åŒ–
- [ ] å­¦ä¹ è·¯å¾„ç”Ÿæˆ

---

## ğŸ’° é¢„æœŸæ”¶ç›Š

### åŠŸèƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| AIåŠŸèƒ½ä½¿ç”¨ç‡ | 20% | 50% | +150% |
| æ¨èç‚¹å‡»ç‡ | - | 35% | æ–°å¢ |
| æœç´¢æ»¡æ„åº¦ | 60% | 85% | +42% |
| é”™é¢˜å¤ä¹ ç‡ | 30% | 60% | +100% |

### ç”¨æˆ·ä½“éªŒ

- âœ… **ä¸ªæ€§åŒ–å­¦ä¹ **: æ ¹æ®ç”¨æˆ·ä¹ æƒ¯æ¨èå†…å®¹
- âœ… **è‡ªç„¶äº¤äº’**: ç”¨æ—¥å¸¸è¯­è¨€å³å¯æœç´¢
- âœ… **æ·±åº¦åˆ†æ**: ä¸ä»…çŸ¥é“é”™åœ¨å“ªï¼Œè¿˜çŸ¥é“ä¸ºä»€ä¹ˆé”™
- âœ… **å­¦ä¹ è·¯å¾„**: æ˜ç¡®çš„æå‡æ–¹å‘

### æŠ€æœ¯ä»·å€¼

- âœ… **ç®—æ³•ç§¯ç´¯**: ååŒè¿‡æ»¤ã€NLPç­‰AIç®—æ³•
- âœ… **æ•°æ®èµ„äº§**: ç”¨æˆ·è¡Œä¸ºæ•°æ®ã€çŸ¥è¯†å›¾è°±
- âœ… **æŠ€æœ¯å£å’**: å·®å¼‚åŒ–ç«äº‰ä¼˜åŠ¿

---

## ğŸ“Œ æ€»ç»“

æœ¬æ–¹æ¡ˆé€šè¿‡ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½çš„ä¼˜åŒ–ï¼Œå°†å­¦ç”Ÿç«¯æ‰“é€ æˆçœŸæ­£çš„**AIæ™ºèƒ½å­¦ä¹ åŠ©æ‰‹**ï¼š

1. **æ™ºèƒ½æ¨èç³»ç»Ÿ**: ä»è¢«åŠ¨å­¦ä¹ åˆ°ä¸»åŠ¨æ¨èï¼Œæå‡å­¦ä¹ æ•ˆç‡
2. **è‡ªç„¶è¯­è¨€æœç´¢**: é™ä½ä½¿ç”¨é—¨æ§›ï¼Œæå‡äº¤äº’ä½“éªŒ
3. **é”™å› æ·±åº¦åˆ†æ**: ä»è¡¨å±‚åˆ†æåˆ°æ·±åº¦è¯Šæ–­ï¼ŒçœŸæ­£å¸®åŠ©å­¦ç”Ÿè¿›æ­¥

é¢„è®¡ä¼˜åŒ–åï¼ŒAIåŠŸèƒ½ä½¿ç”¨ç‡å°†ä»20%æå‡è‡³50%ï¼Œç”¨æˆ·å­¦ä¹ æ•ˆç‡æå‡30%ä»¥ä¸Šã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-10
**ç»´æŠ¤å›¢é˜Ÿ**: AIåŠŸèƒ½ç»„
