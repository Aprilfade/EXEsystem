# åœ¨çº¿ç»ƒä¹ 403æƒé™é—®é¢˜ä¿®å¤è¯´æ˜

## ä¸€ã€é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**:
```
GET http://localhost:5173/api/v1/questions?current=1&size=10&questionType=1&subjectId=1 403 (Forbidden)
```

**é—®é¢˜åŸå› **:
- `BizQuestionController` ç±»ä¸Šæœ‰ `@PreAuthorize("hasAuthority('sys:question:list')")` æƒé™è¦æ±‚
- è¯¥æƒé™æ˜¯**ç®¡ç†å‘˜æƒé™**ï¼Œå­¦ç”Ÿè´¦å·æ²¡æœ‰æ­¤æƒé™
- å­¦ç”Ÿå°è¯•è°ƒç”¨é¢˜åº“æ¥å£æ—¶è¢«æ‹’ç»ï¼Œè¿”å›403

## äºŒã€ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šæ·»åŠ å­¦ç”Ÿä¸“ç”¨æ¥å£

åœ¨ `BizQuestionController` ä¸­æ–°å¢å­¦ç”Ÿä¸“ç”¨çš„ç»ƒä¹ é¢˜ç›®è·å–æ¥å£ã€‚

## ä¸‰ã€å·²å®Œæˆçš„ä¿®æ”¹

### 3.1 åç«¯ä¿®æ”¹

**æ–‡ä»¶**: `exe-backend/src/main/java/com/ice/exebackend/controller/BizQuestionController.java`

**æ–°å¢æ–¹æ³•** (Lines 329-358):

```java
/**
 * ã€æ–°å¢ã€‘å­¦ç”Ÿè·å–ç»ƒä¹ é¢˜ç›®ï¼ˆå…¬å¼€æ¥å£ï¼Œæ— éœ€ç®¡ç†å‘˜æƒé™ï¼‰
 */
@GetMapping("/practice")
@PreAuthorize("hasAuthority('ROLE_STUDENT')")
public Result getPracticeQuestions(@RequestParam(defaultValue = "1") int current,
                                   @RequestParam(defaultValue = "10") int size,
                                   @RequestParam(required = false) Long subjectId,
                                   @RequestParam(required = false) Integer questionType) {
    logger.info("å­¦ç”Ÿè·å–ç»ƒä¹ é¢˜ç›®: subjectId={}, questionType={}, size={}", subjectId, questionType, size);

    Page<BizQuestion> page = new Page<>(current, size);
    QueryWrapper<BizQuestion> queryWrapper = new QueryWrapper<>();

    if (subjectId != null) {
        queryWrapper.eq("subject_id", subjectId);
    }
    if (questionType != null) {
        queryWrapper.eq("question_type", questionType);
    }

    // éšæœºæ’åºï¼Œè®©æ¯æ¬¡è·å–çš„é¢˜ç›®ä¸åŒ
    queryWrapper.orderByAsc("RAND()");

    questionService.page(page, queryWrapper);

    logger.info("æˆåŠŸè·å– {} é“ç»ƒä¹ é¢˜ç›®", page.getRecords().size());
    return Result.suc(page.getRecords(), page.getTotal());
}
```

**å…³é”®ç‰¹æ€§**:
- âœ… æ¥å£è·¯å¾„: `GET /api/v1/questions/practice`
- âœ… æƒé™è¦æ±‚: `ROLE_STUDENT` (å­¦ç”Ÿæƒé™)
- âœ… æ”¯æŒæŒ‰ç§‘ç›®å’Œé¢˜å‹ç­›é€‰
- âœ… éšæœºæ’åºï¼ˆæ¯æ¬¡è·å–ä¸åŒé¢˜ç›®ï¼‰
- âœ… åˆ†é¡µæ”¯æŒ

### 3.2 å‰ç«¯APIä¿®æ”¹

**æ–‡ä»¶**: `exe-frontend/src/api/question.ts`

**æ–°å¢å‡½æ•°** (Lines 130-144):

```typescript
/**
 * ã€æ–°å¢ã€‘å­¦ç”Ÿè·å–ç»ƒä¹ é¢˜ç›®ï¼ˆæ— éœ€ç®¡ç†å‘˜æƒé™ï¼‰
 */
export function fetchPracticeQuestions(params: {
    current: number;
    size: number;
    subjectId?: number;
    questionType?: number;
}): Promise<ApiResult<Question[]>> {
    return request({
        url: '/api/v1/questions/practice',
        method: 'get',
        params
    });
}
```

### 3.3 å‰ç«¯ç»„ä»¶ä¿®æ”¹

**æ–‡ä»¶**: `exe-frontend/src/views/student/AiPractice.vue`

**ä¿®æ”¹å¯¼å…¥** (Line 911):
```typescript
// ä¿®æ”¹å‰
import { fetchQuestionList } from '@/api/question';

// ä¿®æ”¹å
import { fetchPracticeQuestions } from '@/api/question';
```

**ä¿®æ”¹è°ƒç”¨** (Lines 1319 & 1332):
```typescript
// ä¿®æ”¹å‰
const response = await fetchQuestionList({ ... });

// ä¿®æ”¹å
const response = await fetchPracticeQuestions({ ... });
```

## å››ã€éƒ¨ç½²æ­¥éª¤

### Step 1: é‡æ–°ç¼–è¯‘åç«¯

**é‡è¦**: å¿…é¡»é‡æ–°ç¼–è¯‘åç«¯ä»¥åº”ç”¨æ–°æ¥å£ï¼

```bash
# æ–¹å¼1: ä½¿ç”¨Maven Wrapper (æ¨è)
cd D:/Desktop/everything/EXEsystem/exe-backend
./mvnw clean compile -DskipTests

# æ–¹å¼2: å¦‚æœæ–¹å¼1å¤±è´¥ï¼Œä½¿ç”¨cmd
cmd.exe /c "mvnw.cmd clean compile -DskipTests"

# æ–¹å¼3: ä½¿ç”¨è„šæœ¬
cd D:/Desktop/everything/EXEsystem
./compile-backend.bat
```

### Step 2: é‡å¯åç«¯æœåŠ¡

ç¼–è¯‘æˆåŠŸåï¼Œé‡å¯Spring Bootåº”ç”¨ï¼š
```bash
# åœæ­¢å½“å‰æœåŠ¡ (Ctrl+C æˆ– taskkill)
# ç„¶åé‡æ–°å¯åŠ¨
./mvnw spring-boot:run
```

### Step 3: å‰ç«¯æ— éœ€é‡æ–°ç¼–è¯‘

å‰ç«¯ä½¿ç”¨Viteçƒ­æ›´æ–°ï¼Œä¿®æ”¹å·²è‡ªåŠ¨ç”Ÿæ•ˆã€‚

### Step 4: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

```
æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°é¡µé¢
æˆ–åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æ¸…é™¤ç¼“å­˜
```

## äº”ã€éªŒè¯æ­¥éª¤

### 5.1 éªŒè¯åç«¯æ¥å£

ä½¿ç”¨æµè§ˆå™¨æˆ–Postmanæµ‹è¯•ï¼š

```bash
# è¯·æ±‚ç¤ºä¾‹
GET http://localhost:8080/api/v1/questions/practice?current=1&size=10&subjectId=1&questionType=1

# è¯·æ±‚å¤´éœ€è¦åŒ…å«å­¦ç”ŸToken
Authorization: Bearer <student_token>
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "msg": "success",
  "data": [
    {
      "id": 1,
      "subjectId": 1,
      "questionType": 1,
      "content": "é¢˜ç›®å†…å®¹...",
      "options": "[{\"key\":\"A\",\"value\":\"é€‰é¡¹A\"}]",
      "answer": "A",
      "description": "è§£æ..."
    }
  ],
  "total": 50
}
```

### 5.2 éªŒè¯å‰ç«¯åŠŸèƒ½

1. ç™»å½•å­¦ç”Ÿè´¦å·
2. è¿›å…¥"AIç»ƒä¹ ç”Ÿæˆ"é¡µé¢
3. é€‰æ‹©ç§‘ç›®ï¼ˆå¦‚æ•°å­¦ï¼‰
4. é€‰æ‹©é¢˜å‹ï¼ˆå¦‚å•é€‰ï¼‰
5. ç‚¹å‡»"ç”Ÿæˆç»ƒä¹ "
6. åº”è¯¥æˆåŠŸç”Ÿæˆé¢˜ç›®ï¼Œä¸å†å‡ºç°403é”™è¯¯

**æˆåŠŸæ ‡å¿—**:
- âœ… æ§åˆ¶å°æ— 403é”™è¯¯
- âœ… æ˜¾ç¤º"æˆåŠŸç”ŸæˆXé“ç»ƒä¹ é¢˜ï¼"
- âœ… æ‰€æœ‰é¢˜ç›®éƒ½æ˜¯çœŸå®å†…å®¹ï¼ˆéå ä½ç¬¦ï¼‰

## å…­ã€æƒé™å¯¹æ¯”

### æ—§æ¥å£ (ç®¡ç†å‘˜ä¸“ç”¨)
```
è·¯å¾„: GET /api/v1/questions
æƒé™: sys:question:list (ç®¡ç†å‘˜)
ç”¨é€”: é¢˜åº“ç®¡ç†åå°ä½¿ç”¨
```

### æ–°æ¥å£ (å­¦ç”Ÿä¸“ç”¨)
```
è·¯å¾„: GET /api/v1/questions/practice
æƒé™: ROLE_STUDENT (å­¦ç”Ÿ)
ç”¨é€”: å­¦ç”Ÿåœ¨çº¿ç»ƒä¹ ä½¿ç”¨
```

## ä¸ƒã€å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘åç«¯æ—¶å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A**:
1. ç¡®è®¤Javaç‰ˆæœ¬ä¸º17ï¼ˆ`java -version`ï¼‰
2. æ£€æŸ¥JAVA_HOMEç¯å¢ƒå˜é‡
3. å°è¯•ä½¿ç”¨ `compile-backend.bat` è„šæœ¬
4. å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå°è¯•åœ¨IDEï¼ˆå¦‚IntelliJ IDEAï¼‰ä¸­ç›´æ¥ç¼–è¯‘

### Q2: é‡å¯åç«¯åè¿˜æ˜¯403é”™è¯¯ï¼Ÿ
**A**:
1. ç¡®è®¤åç«¯ç¼–è¯‘æˆåŠŸå¹¶é‡å¯
2. æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰æ–°æ¥å£æ³¨å†Œä¿¡æ¯
3. åœ¨æµè§ˆå™¨æ§åˆ¶å°Networkæ ‡ç­¾ä¸­æŸ¥çœ‹è¯·æ±‚URLæ˜¯å¦ä¸º `/api/v1/questions/practice`
4. ç¡®è®¤å­¦ç”ŸTokenæœ‰æ•ˆ

### Q3: æ¥å£è¿”å›ç©ºæ•°ç»„æ€ä¹ˆåŠï¼Ÿ
**A**:
è¿™è¯´æ˜æƒé™é—®é¢˜å·²è§£å†³ï¼Œä½†é¢˜åº“ä¸­æ²¡æœ‰å¯¹åº”ç§‘ç›®å’Œé¢˜å‹çš„é¢˜ç›®ã€‚è¯·ï¼š
1. ç™»å½•ç®¡ç†åå°
2. è¿›å…¥é¢˜åº“ç®¡ç†
3. æ·»åŠ æˆ–å¯¼å…¥é¢˜ç›®
4. ç¡®ä¿é¢˜ç›®çš„subjectIdå’ŒquestionTypeæ­£ç¡®

### Q4: éšæœºæ’åºå½±å“æ€§èƒ½å—ï¼Ÿ
**A**:
- å¯¹äºå°æ•°æ®é‡ï¼ˆ<10000é¢˜ï¼‰ï¼šå½±å“å¾ˆå°
- å¯¹äºå¤§æ•°æ®é‡ï¼šå¯ä»¥ç§»é™¤ `orderByAsc("RAND()")` æ”¹ç”¨åº”ç”¨å±‚éšæœº

## å…«ã€åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **ç¼“å­˜é¢˜åº“**: å¯¹å¸¸ç”¨ç§‘ç›®çš„é¢˜ç›®è¿›è¡ŒRedisç¼“å­˜
2. **é¢˜ç›®éš¾åº¦**: æ·»åŠ éš¾åº¦å‚æ•°ï¼Œæ”¯æŒæŒ‰éš¾åº¦ç­›é€‰
3. **çŸ¥è¯†ç‚¹ç­›é€‰**: æ”¯æŒæŒ‰çŸ¥è¯†ç‚¹IDç­›é€‰é¢˜ç›®

### é•¿æœŸä¼˜åŒ–
1. **æ™ºèƒ½æ¨è**: åŸºäºå­¦ç”Ÿå†å²ç­”é¢˜è®°å½•æ¨èé¢˜ç›®
2. **é˜²é‡å¤**: è®°å½•å­¦ç”Ÿå·²ç»ƒä¹ é¢˜ç›®ï¼Œé¿å…çŸ­æœŸå†…é‡å¤
3. **ä¸ªæ€§åŒ–**: æ ¹æ®å­¦ç”Ÿè–„å¼±çŸ¥è¯†ç‚¹åŠ¨æ€è°ƒæ•´é¢˜ç›®

## ä¹ã€ä»£ç ç»Ÿè®¡

| æ”¹åŠ¨ç±»å‹ | æ–‡ä»¶ | è¡Œæ•° |
|---------|------|------|
| æ–°å¢æ¥å£ | BizQuestionController.java | +30è¡Œ |
| æ–°å¢APIå‡½æ•° | question.ts | +15è¡Œ |
| ä¿®æ”¹ç»„ä»¶ | AiPractice.vue | 2å¤„è°ƒç”¨ |
| **æ€»è®¡** | **3ä¸ªæ–‡ä»¶** | **+45è¡Œ** |

## åã€æ€»ç»“

æœ¬æ¬¡ä¿®å¤è§£å†³äº†å­¦ç”Ÿè´¦å·æ— æƒé™è®¿é—®é¢˜åº“æ¥å£çš„é—®é¢˜ï¼š

âœ… **é—®é¢˜æ ¹æº**: å­¦ç”Ÿè´¦å·ç¼ºå°‘ç®¡ç†å‘˜æƒé™ `sys:question:list`
âœ… **è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºå­¦ç”Ÿä¸“ç”¨æ¥å£ `/api/v1/questions/practice`
âœ… **æƒé™è®¾ç½®**: ä½¿ç”¨ `ROLE_STUDENT` æƒé™ï¼Œå­¦ç”Ÿå¯è®¿é—®
âœ… **åŠŸèƒ½å¢å¼º**: æ”¯æŒéšæœºæ’åºï¼Œæ¯æ¬¡ç»ƒä¹ é¢˜ç›®ä¸åŒ
âœ… **ä»£ç è´¨é‡**: æ¸…æ™°çš„æƒé™åˆ†ç¦»ï¼Œç¬¦åˆæœ€å°æƒé™åŸåˆ™

**ä¿®å¤å®Œæˆåï¼Œå­¦ç”Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨åœ¨çº¿ç»ƒä¹ åŠŸèƒ½äº†ï¼** ğŸ‰

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2026-01-11
**ä¿®å¤ç‰ˆæœ¬**: v3.10
**æ¶‰åŠæ–‡ä»¶**: 3ä¸ªæ–‡ä»¶
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ï¼ˆé˜»å¡åŠŸèƒ½ä½¿ç”¨ï¼‰
