# 🚨 紧急修复：Dashboard功能完全恢复指南（更新版）

## 问题根源

数据库缺少核心表：`biz_student_paper` （学生试卷表）

## ✅ 修复方案（2个SQL文件，分步执行）

### 步骤 1：创建核心表（必须执行）

在数据库管理工具中执行：**`创建系统核心表-修复版.sql`**

这个SQL会创建：
- ✅ `biz_student_paper` 表（学生试卷表）
- ✅ `biz_student_knowledge_mastery` 表（学生知识点掌握度表）
- ✅ `biz_paper_knowledge_point` 表（试卷知识点关联表）
- ✅ 插入测试数据

**执行结果**：应该看到 `✅ 核心表创建完成！` 的提示。

---

### 步骤 2：添加审核状态字段（必须执行）

在数据库管理工具中执行：**`添加audit_status字段.sql`**

这个SQL会：
- ✅ 为 `biz_question` 表添加 `audit_status` 字段

**重要提示**：
- ⚠️ 如果报错 `Duplicate column name 'audit_status'`，说明字段已经存在，**这是正常的**
- ✅ 可以直接忽略这个错误，继续下一步

**执行结果**：应该看到 `✅ audit_status字段添加完成！` 的提示（或者报错Duplicate，都是正常的）。

---

### 步骤 3：重启后端（30秒）

**停止后端**：
- 在IDEA中点击停止按钮（红色方块），或按 Ctrl+F2
- 或者在后端控制台按 Ctrl+C

**启动后端**：
- 在IDEA中右键 `ExeBackendApplication.java` → Run
- 或者使用Maven：`cd exe-backend && mvnw.cmd spring-boot:run`

**等待启动成功**，看到：
```
Started ExeBackendApplication in X.XXX seconds
```

---

### 步骤 4：刷新前端（5秒）

在浏览器中按 **F5** 或 **Ctrl+R** 刷新页面。

---

## 🎯 修复后的效果

Dashboard页面将正常显示：

### 1. 待办事项卡片
- 待批改试卷：X 份
- 待审核题目：X 道
- 显示最近提交时间

### 2. 最近活动列表
- 学生提交试卷记录
- 题目创建记录
- 学生导入记录
- 时间倒序排列，最新5条

### 3. 薄弱知识点图表
- 掌握度低于60%的知识点
- 显示Top 10
- 包含学生人数统计

---

## 📊 验证是否修复成功

打开浏览器开发者工具（F12），查看Console：

**修复前**（错误）：
```
获取待办事项失败: Error: 获取待办事项失败
获取最近活动失败: Error: 获取最近活动失败
获取薄弱知识点失败: Error: 获取薄弱知识点失败
```

**修复后**（正常）：
```
🔔 实时通知服务已连接
（没有任何错误信息）
```

Dashboard页面正常显示数据，不再有红色错误。

---

## ⚠️ 常见问题

### Q1: 第二个SQL报错 "Duplicate column name"

**答**：这是正常的！说明 `audit_status` 字段已经存在，可以忽略这个错误，直接进行步骤3重启后端。

### Q2: SQL执行后没有任何输出

**答**：正常！只要没有红色错误提示，就说明执行成功了。可以在数据库中查看表是否创建成功。

### Q3: 后端启动失败

**检查步骤**：
1. 确认JAVA_HOME指向JDK 17
2. 查看后端日志中的错误信息
3. 确认8080端口没有被占用

### Q4: 前端刷新后仍然报错

**检查步骤**：
1. 确认两个SQL都执行成功
2. 确认后端已重启
3. 清除浏览器缓存（Ctrl+Shift+Delete）
4. 查看后端日志搜索 "获取待办事项"，看是否有错误

---

## 📝 需要执行的文件清单

1. ✅ **创建系统核心表-修复版.sql** （必须执行）
2. ✅ **添加audit_status字段.sql** （必须执行，报错Duplicate可忽略）

---

**创建时间**: 2026-01-09
**状态**: ✅ SQL已修复，按顺序执行即可
**预计修复时间**: 2-3分钟
