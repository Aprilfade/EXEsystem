# å¾…åŠäº‹é¡¹é…ç½®åŒ–åŠŸèƒ½ - ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

å¾…åŠäº‹é¡¹é…ç½®åŒ–åŠŸèƒ½å·²æˆåŠŸå®ç°ï¼ç°åœ¨ä½ å¯ä»¥é€šè¿‡æ•°æ®åº“é…ç½®æ¥ç®¡ç†å¾…åŠäº‹é¡¹ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

**å®ç°æ—¥æœŸ**: 2026-01-10
**çŠ¶æ€**: âœ… ç¼–è¯‘é€šè¿‡ï¼Œå¯ä»¥ä½¿ç”¨

---

## ä¸€ã€æ–°å¢çš„æ–‡ä»¶

### æ•°æ®åº“è„šæœ¬
```
todo-config-setup.sql               (å¾…åŠäº‹é¡¹é…ç½®è¡¨åˆ›å»ºè„šæœ¬)
```

### åç«¯ä»£ç 
```
exe-backend/src/main/java/com/ice/exebackend/
â”œâ”€â”€ entity/
â”‚   â””â”€â”€ SysTodoConfig.java          (å¾…åŠé…ç½®å®ä½“ç±»)
â”œâ”€â”€ mapper/
â”‚   â””â”€â”€ SysTodoConfigMapper.java    (Mapperæ¥å£)
â””â”€â”€ resources/mapper/
    â””â”€â”€ SysTodoConfigMapper.xml      (MyBatis XMLé…ç½®)
```

### ä¿®æ”¹çš„æ–‡ä»¶
```
exe-backend/src/main/java/com/ice/exebackend/service/impl/
â””â”€â”€ DashboardServiceImpl.java       (ä½¿ç”¨é…ç½®åŒ–æ–¹å¼åŠ è½½å¾…åŠ)
```

---

## äºŒã€å¦‚ä½•ä½¿ç”¨

### æ­¥éª¤1ï¼šæ‰§è¡Œæ•°æ®åº“è„šæœ¬ âš ï¸ å¿…é¡»æ‰§è¡Œ

åœ¨Navicatæˆ–å…¶ä»–MySQLå®¢æˆ·ç«¯ä¸­æ‰§è¡Œï¼š

```bash
todo-config-setup.sql
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. âœ… åˆ›å»º `sys_todo_config` é…ç½®è¡¨
2. âœ… æ’å…¥2æ¡åˆå§‹é…ç½®æ•°æ®ï¼ˆå¾…æ‰¹æ”¹è¯•å·ã€å¾…å®¡æ ¸é¢˜ç›®ï¼‰
3. âœ… éªŒè¯æ•°æ®æ˜¯å¦æ’å…¥æˆåŠŸ

### æ­¥éª¤2ï¼šé‡å¯åç«¯æœåŠ¡

```bash
# åœæ­¢å½“å‰æœåŠ¡
# é‡æ–°å¯åŠ¨åç«¯
cd exe-backend
./mvnw spring-boot:run
```

### æ­¥éª¤3ï¼šéªŒè¯åŠŸèƒ½

è®¿é—®å·¥ä½œå°é¡µé¢ï¼Œå¾…åŠäº‹é¡¹åº”è¯¥æ­£å¸¸æ˜¾ç¤ºã€‚

---

## ä¸‰ã€é…ç½®è¡¨ç»“æ„

### sys_todo_config è¡¨å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| id | bigint | ä¸»é”®ID | 1 |
| type | varchar(50) | å¾…åŠç±»å‹å”¯ä¸€æ ‡è¯† | pending_papers |
| title | varchar(100) | å¾…åŠæ ‡é¢˜ | å¾…æ‰¹æ”¹è¯•å· |
| icon | varchar(50) | Element Pluså›¾æ ‡å | Document |
| color | varchar(100) | æ¸å˜è‰²CSS | linear-gradient(...) |
| action | varchar(200) | è·³è½¬è·¯ç”±ï¼ˆä¸å«/ï¼‰ | score-manage?status=1 |
| mapper_method | varchar(100) | Mapperæ–¹æ³•å | getPendingPapersCount |
| enabled | tinyint(1) | æ˜¯å¦å¯ç”¨ | 1=å¯ç”¨, 0=ç¦ç”¨ |
| sort_order | int | æ’åºåºå· | 10ï¼ˆè¶Šå°è¶Šé å‰ï¼‰ |
| description | varchar(255) | è¯´æ˜æè¿° | å­¦ç”Ÿæäº¤ä½†å°šæœªæ‰¹æ”¹çš„è¯•å· |

---

## å››ã€å¦‚ä½•æ·»åŠ æ–°çš„å¾…åŠäº‹é¡¹

### ç¤ºä¾‹ï¼šæ·»åŠ "å³å°†åˆ°æœŸçš„è€ƒè¯•"å¾…åŠ

#### 1. åœ¨DashboardMapperä¸­æ·»åŠ æŸ¥è¯¢æ–¹æ³•

**æ–‡ä»¶**: `exe-backend/src/main/java/com/ice/exebackend/mapper/DashboardMapper.java`

```java
@Mapper
public interface DashboardMapper {
    // ... ç°æœ‰æ–¹æ³• ...

    /**
     * æŸ¥è¯¢å³å°†åˆ°æœŸçš„è€ƒè¯•æ•°é‡ï¼ˆ3å¤©å†…ï¼‰
     */
    Map<String, Object> getExpiringExamsCount();
}
```

#### 2. åœ¨DashboardMapper.xmlæ·»åŠ SQLæŸ¥è¯¢

**æ–‡ä»¶**: `exe-backend/src/main/resources/mapper/DashboardMapper.xml`

```xml
<!-- å³å°†åˆ°æœŸçš„è€ƒè¯• -->
<select id="getExpiringExamsCount" resultType="java.util.Map">
    SELECT
        COUNT(*) AS count,
        MIN(end_time) AS latestTime
    FROM biz_paper
    WHERE end_time BETWEEN NOW() AND DATE_ADD(NOW(), INTERVAL 3 DAY)
      AND status = 1
</select>
```

#### 3. åœ¨æ•°æ®åº“ä¸­æ·»åŠ é…ç½®

```sql
INSERT INTO sys_todo_config
(type, title, icon, color, action, mapper_method, enabled, sort_order, description)
VALUES
('expiring_exams',
 'å³å°†åˆ°æœŸçš„è€ƒè¯•',
 'Timer',
 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
 'papers?filter=expiring',
 'getExpiringExamsCount',
 1,
 30,
 'è·ç¦»ç»“æŸæ—¶é—´ä¸è¶³3å¤©çš„è€ƒè¯•');
```

#### 4. é‡å¯æœåŠ¡

```bash
cd exe-backend
./mvnw spring-boot:run
```

å°±è¿™ä¹ˆç®€å•ï¼æ–°çš„å¾…åŠäº‹é¡¹ä¼šè‡ªåŠ¨å‡ºç°åœ¨å·¥ä½œå°ã€‚

---

## äº”ã€ç®¡ç†å¾…åŠäº‹é¡¹

### å¯ç”¨/ç¦ç”¨å¾…åŠ

```sql
-- ç¦ç”¨"å¾…å®¡æ ¸é¢˜ç›®"
UPDATE sys_todo_config SET enabled = 0 WHERE type = 'pending_questions';

-- é‡æ–°å¯ç”¨
UPDATE sys_todo_config SET enabled = 1 WHERE type = 'pending_questions';
```

### ä¿®æ”¹æ˜¾ç¤ºé¡ºåº

```sql
-- è°ƒæ•´æ’åºï¼ˆæ•°å­—è¶Šå°è¶Šé å‰ï¼‰
UPDATE sys_todo_config SET sort_order = 5 WHERE type = 'expiring_exams';
UPDATE sys_todo_config SET sort_order = 10 WHERE type = 'pending_papers';
UPDATE sys_todo_config SET sort_order = 20 WHERE type = 'pending_questions';
```

### ä¿®æ”¹æ ·å¼

```sql
-- ä¿®æ”¹å›¾æ ‡å’Œé¢œè‰²
UPDATE sys_todo_config
SET icon = 'Star',
    color = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
WHERE type = 'pending_papers';
```

### ä¿®æ”¹è·³è½¬è·¯ç”±

```sql
-- ä¿®æ”¹ç‚¹å‡»åçš„è·³è½¬åœ°å€
UPDATE sys_todo_config
SET action = 'score-manage?status=1&sort=time'
WHERE type = 'pending_papers';
```

---

## å…­ã€é…ç½®åŒ– vs ç¡¬ç¼–ç å¯¹æ¯”

### ç¡¬ç¼–ç æ–¹å¼ï¼ˆæ—§ï¼‰

âŒ å¾…åŠç±»å‹å›ºå®šï¼Œåªæœ‰2ç§
âŒ æ·»åŠ æ–°å¾…åŠéœ€è¦æ”¹ä»£ç ã€é‡æ–°ç¼–è¯‘
âŒ ä¿®æ”¹æ ·å¼éœ€è¦æ”¹ä»£ç 
âŒ æ— æ³•åŠ¨æ€å¯ç”¨/ç¦ç”¨

```java
// ç¡¬ç¼–ç  - éœ€è¦æ”¹ä»£ç 
item.setTitle("å¾…æ‰¹æ”¹è¯•å·");
item.setIcon("Document");
item.setColor("linear-gradient(...)");
item.setAction("score-manage?status=1");
```

### é…ç½®åŒ–æ–¹å¼ï¼ˆæ–°ï¼‰

âœ… å¾…åŠç±»å‹åŠ¨æ€å¯æ‰©å±•
âœ… æ·»åŠ æ–°å¾…åŠåªéœ€INSERTé…ç½®
âœ… ä¿®æ”¹æ ·å¼åªéœ€UPDATEé…ç½®
âœ… æ”¯æŒåŠ¨æ€å¯ç”¨/ç¦ç”¨
âœ… æ— éœ€æ”¹ä»£ç ã€æ— éœ€é‡æ–°ç¼–è¯‘

```java
// é…ç½®åŒ– - ä»æ•°æ®åº“è¯»å–
List<SysTodoConfig> configs = todoConfigMapper.selectEnabledConfigs();
for (SysTodoConfig config : configs) {
    // è‡ªåŠ¨å¡«å……é…ç½®çš„å€¼
    item.setTitle(config.getTitle());
    item.setIcon(config.getIcon());
    item.setColor(config.getColor());
    item.setAction(config.getAction());
}
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜ FAQ

### Q1: æ‰§è¡ŒSQLè„šæœ¬åéœ€è¦é‡å¯æœåŠ¡å—ï¼Ÿ

**A**:
- æ·»åŠ /ä¿®æ”¹é…ç½®åï¼š**éœ€è¦é‡å¯**åç«¯æœåŠ¡
- åªæ˜¯å¯ç”¨/ç¦ç”¨ï¼š**éœ€è¦é‡å¯**åç«¯æœåŠ¡
- å»ºè®®ï¼šå¼€å‘ç¯å¢ƒä½¿ç”¨çƒ­é‡è½½ï¼ˆSpring DevToolsï¼‰

### Q2: å¯ä»¥æ·»åŠ å¤šå°‘ä¸ªå¾…åŠäº‹é¡¹ï¼Ÿ

**A**: ç†è®ºä¸Šæ— é™åˆ¶ï¼Œä½†å»ºè®®ä¸è¶…è¿‡5ä¸ªï¼Œä»¥ä¿æŒé¡µé¢ç®€æ´ã€‚

### Q3: mapper_methodå¿…é¡»å·²ç»å­˜åœ¨å—ï¼Ÿ

**A**: æ˜¯çš„ã€‚ä½ éœ€è¦å…ˆåœ¨ `DashboardMapper` ä¸­å®ç°å¯¹åº”çš„æŸ¥è¯¢æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

### Q4: å¦‚æœMapperæ–¹æ³•è°ƒç”¨å¤±è´¥ä¼šæ€æ ·ï¼Ÿ

**A**: è¯¥å¾…åŠé¡¹ä¸ä¼šæ˜¾ç¤ºï¼Œä½†ä¸å½±å“å…¶ä»–å¾…åŠé¡¹ã€‚é”™è¯¯ä¼šè®°å½•åœ¨æ§åˆ¶å°æ—¥å¿—ä¸­ã€‚

### Q5: å¦‚ä½•å›æ»šåˆ°ç¡¬ç¼–ç æ–¹å¼ï¼Ÿ

**A**:
```sql
-- åˆ é™¤é…ç½®è¡¨
DROP TABLE sys_todo_config;

-- ç„¶åæ¢å¤ DashboardServiceImpl.java çš„åŸå§‹ä»£ç 
```

---

## å…«ã€æ‰©å±•å»ºè®®

### å¯ä»¥æ·»åŠ çš„å¾…åŠç±»å‹

1. **é•¿æœŸæœªæ‰¹æ”¹çš„è¯•å·**
   - è¶…è¿‡7å¤©æœªæ‰¹æ”¹
   - å›¾æ ‡: Warning
   - é¢œè‰²: çº¢è‰²æ¸å˜

2. **å­¦ç”Ÿåé¦ˆ/ç”³è¯‰**
   - å­¦ç”Ÿæäº¤çš„é—®é¢˜åé¦ˆ
   - å›¾æ ‡: ChatDotRound
   - é¢œè‰²: æ©™è‰²æ¸å˜

3. **ç³»ç»Ÿé€šçŸ¥**
   - æœªè¯»çš„ç³»ç»Ÿé€šçŸ¥
   - å›¾æ ‡: Bell
   - é¢œè‰²: è“è‰²æ¸å˜

4. **æ•°æ®å¯¼å…¥ä»»åŠ¡**
   - æ‰¹é‡å¯¼å…¥å­¦ç”Ÿ/é¢˜ç›®çš„ä»»åŠ¡
   - å›¾æ ‡: Upload
   - é¢œè‰²: ç»¿è‰²æ¸å˜

---

## ä¹ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

å½“å‰å®ç°ä½¿ç”¨åå°„è°ƒç”¨Mapperæ–¹æ³•ï¼Œæ€§èƒ½å·²ç»è¶³å¤Ÿå¥½ã€‚å¦‚æœæœªæ¥å¾…åŠç±»å‹è¶…è¿‡10ä¸ªï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **æ·»åŠ ç¼“å­˜**
```java
@Cacheable(value = "todo:configs", ttl = 3600)
public List<SysTodoConfig> getEnabledConfigs() {
    return todoConfigMapper.selectEnabledConfigs();
}
```

2. **ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ›¿ä»£åå°„**
```java
Map<String, TodoQueryStrategy> strategies = new HashMap<>();
strategies.put("getPendingPapersCount", () -> dashboardMapper.getPendingPapersCount());
```

---

## åã€æŠ€æœ¯å®ç°ç»†èŠ‚

### æ ¸å¿ƒå®ç°é€»è¾‘

```java
// 1. ä»æ•°æ®åº“è¯»å–é…ç½®
List<SysTodoConfig> configs = todoConfigMapper.selectEnabledConfigs();

// 2. éå†é…ç½®ï¼ŒåŠ¨æ€è°ƒç”¨Mapperæ–¹æ³•
for (SysTodoConfig config : configs) {
    // 3. ä½¿ç”¨åå°„è°ƒç”¨å¯¹åº”çš„æ–¹æ³•
    String methodName = config.getMapperMethod();
    Map<String, Object> result = (Map<String, Object>)
        dashboardMapper.getClass().getMethod(methodName).invoke(dashboardMapper);

    // 4. å¤„ç†ç»“æœï¼Œæ„å»ºTodoItemDTO
    if (result != null && count > 0) {
        TodoItemDTO item = new TodoItemDTO();
        item.setTitle(config.getTitle());
        item.setIcon(config.getIcon());
        // ...
    }
}

// 5. æ™ºèƒ½æ’åºï¼ˆæŒ‰æ•°é‡é™åºï¼‰
items.sort((a, b) -> b.getCount() - a.getCount());
```

---

## åä¸€ã€æ€»ç»“

âœ… **é…ç½®åŒ–å®ç°å®Œæˆ**
âœ… **åç«¯ç¼–è¯‘é€šè¿‡**
âœ… **å‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½**
âœ… **æ‰©å±•æ€§å¼ºï¼Œæ˜“äºç»´æŠ¤**

ç°åœ¨ä½ å¯ä»¥ï¼š
- ğŸ¯ é€šè¿‡SQLè½»æ¾æ·»åŠ æ–°çš„å¾…åŠç±»å‹
- ğŸ¯ åŠ¨æ€è°ƒæ•´å¾…åŠäº‹é¡¹çš„æ˜¾ç¤ºå’Œè¡Œä¸º
- ğŸ¯ æ— éœ€ä¿®æ”¹ä»£ç å³å¯ç®¡ç†å¾…åŠäº‹é¡¹

---

**åˆ›å»ºæ—¶é—´**: 2026-01-10
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ä½œè€…**: Claude Code Assistant

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åé¦ˆï¼
